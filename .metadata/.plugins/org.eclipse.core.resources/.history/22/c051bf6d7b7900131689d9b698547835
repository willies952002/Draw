package tk.willies952002.java.GitUpload;

import java.lang.Runtime;
import java.lang.Runnable;
import javax.swing.*;
import java.awt.Container;
import java.awt.EventQueue;
import java.awt.BorderLayout;
import java.awt.FlowLayout;
import java.util.Scanner;
import java.awt.event.ActionEvent;
import java.io.InputStream;


public class GitUpload extends JFrame implements Runnable {

	private static String gitUser;
	private static String gitPass;
	private static boolean instantiated = false;

	JTextField gitPathField = new JTextField();

	JTextField gitUserField = new JTextField();

	JTextField gitPassField = new JTextField();
		
	JTextField gitCommitMsg = new JTextField();

	public GitUpload() {
		this.instantiated = true;
	}

	public GitUpload(InputStream in) {
		this(new Scanner(in).nextLine(), new Scanner(in).nextLine());
	}

	public GitUpload(String user, String oauth) {
		this.instantiated = false;
		this.gitUser = user;
		this.gitPass = oauth;
	}

	@Override
	public void run() {
		buildUI();
		this.setVisible(true);
	}

	public void buildUI() {
		setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
		setBounds(100, 100, 450, 300);
		Container contentPane = this.getContentPane();

		JButton commitBtn = new JButton("Commit And Push");
		commitBtn.setAction(new GitAction());

		contentPane.setLayout(new BorderLayout());
		contentPane.add(new JLabel("Path To Remote (HTTPS Only): "));
		contentPane.add(gitPathField, BorderLayout.NORTH);
		contentPane.add(gitCommitMsg, BorderLayout.CENTER);
		if ( this.isInstantiated() ) {
			JPanel panel = new JPanel();
			panel.setLayout(new FlowLayout());
			panel.add(new JLabel("Username: "));
				gitUserField.setColumns(20);
				gitPassField.setColumns(35);
				panel.add(gitUserField);
				panel.add(new JLabel("Password: "));
				panel.add(gitPassField);
			contentPane.add(panel, BorderLayout.WEST); 
		}
		contentPane.add(commitBtn, BorderLayout.SOUTH);

	}

	public boolean isInstantiated() {
		return instantiated;
	}

	public static void main(String[] args) {
		EventQueue.invokeLater(new GitUpload());
	}

	public class GitAction extends AbstractAction {
		public GitAction() {
			putValue(NAME, "Commit And Push");
		}
		public void actionPerformed(ActionEvent event) {
			try {
				//Runtime.getRuntime().exec("git", new String[] {"commit", "-a", "-m\"" + gitCommitMsg.getText() + "\"" } );
				System.out.println("git commit -a -m\"" + gitCommitMsg.getText() + "\"");
				Thread.sleep(100);
				//Runtime.getRuntime().exec("git", new String[] {"push", "https://" + (isInstantiated() ? gitUserField.getText() : gitUser) + "@" + gitPathField.getText(), "master" });
				System.out.println( "git push https://" + (isInstantiated() ? gitUserField.getText() : gitUser) + "@" + gitPathField.getText() + " master" );
			}
			catch (Exception e) {
				e.printStackTrace();
			}
		}
	}	

}